angular.module("fluro.socket",[]),angular.module("fluro.socket").service("FluroSocket",function($rootScope){function receiveMessage(data){console.log("Retrieved Socket Message",data)}var controller={},host=window.location.origin,socket=io(host),currentRoom="";return $rootScope.$watch("user.account._id",function(id){id?controller.join(id):controller.leave(currentRoom)}),controller.join=function(roomName){currentRoom=roomName,socket.on("connect",function(){console.log("Socket connected"),socket.on("content",receiveMessage),socket.emit("subscribe",{room:roomName})}),socket.on("reconnect",function(){console.log("Socket reconnected"),socket.on("content",receiveMessage),socket.emit("subscribe",{room:roomName})}),socket.on("disconnect",function(){console.log("Socket disconnected"),socket.off("content",receiveMessage)})},controller.leave=function(roomName){socket.off("content",receiveMessage),socket.emit("unsubscribe",{room:roomName}),socket.off("connect"),socket.off("reconnect"),socket.off("disconnect")},controller.on=function(event,callback){socket.on(event,callback)},controller.off=function(event,callback){socket.off(event,callback)},controller});